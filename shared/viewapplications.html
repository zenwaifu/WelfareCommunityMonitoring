<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Applications - Digital Village</title>
    
    <link rel="stylesheet" href="../style.css"> 

    <style>
        /* Table-specific styles */
        .page-title { margin-bottom: 20px; color: #2b8fae; font-size: 28px; font-weight: 700; }
        
        .table-container { 
            width: 100%; 
            background: #fff;
            border: 2px solid #000; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 5px 5px 0px rgba(0,0,0,0.1);
        }
        
        .table-header { 
            display: flex; 
            background: #7dc9e1; 
            border-bottom: 2px solid #000; 
            font-weight: 800; 
            color: #000;
        }
        
        .table-row { 
            display: flex; 
            border-bottom: 1px solid #eee; 
            transition: 0.2s; 
            align-items: center;
        }
        
        .table-row:last-child { border-bottom: none; }
        .table-row:hover { background-color: #f0f7f9; }
        
        .table-cell, .table-header-cell { 
            flex: 1; 
            padding: 15px; 
            text-align: left; 
            font-size: 16px;
        }
        
        .status-pill { 
            padding: 5px 12px; 
            border-radius: 15px; 
            font-size: 11px; 
            font-weight: 700; 
            text-transform: uppercase; 
            border: 1px solid rgba(0,0,0,0.1); 
        }
        .pill-approved { background: #d1fae5; color: #065f46; }
        .pill-pending { background: #fef3c7; color: #92400e; }
        
        .view-btn { 
            background: #7dc9e1; 
            border: 1px solid #000; 
            padding: 8px 20px; 
            border-radius: 20px; 
            cursor: pointer; 
            font-weight: 700; 
            transition: 0.3s;
            text-decoration: none;
            display: inline-block;
            color: #000;
            font-size: 14px;
            text-align: center;
        }
        
        .view-btn:hover { 
            background: #5db7d3; 
            transform: scale(1.05);
            box-shadow: 2px 2px 0px #000;
        }

        @media (max-width: 768px) {
            .table-header { display: none; }
            .table-row { flex-direction: column; padding: 15px; border-bottom: 2px solid #000; }
            .table-cell { padding: 5px 0; width: 100%; }
            .table-cell:before { content: attr(data-label); font-weight: bold; margin-right: 10px; }
        }
    </style>
</head>
<body>

    <nav class="top-nav">
        <div class="nav-brand">DIGITAL VILLAGE</div>
        <div class="admin-profile">
            <div class="admin-info">
                <div class="admin-name" id="displayUserName">Username</div>
                <div class="admin-role" id="displayUserRole" style="font-size: 11px; font-weight: bold; opacity: 0.7; text-transform: uppercase;">Role</div>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </nav>

    <div class="layout-body">
        <aside class="sidebar" id="sidebarMenu"></aside>

        <main class="main-content">
            <div class="content-card">
                <h2 class="page-title" id="tableTitle">Loading...</h2>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-header-cell">Applicant Name</div>
                        <div class="table-header-cell">Aid Type</div>
                        <div class="table-header-cell">Date</div>
                        <div class="table-header-cell">Status</div>
                        <div class="table-header-cell">Action</div>
                    </div>
                    
                    <div id="applicationTableBody">
                        </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sessionData = localStorage.getItem('currentUser');
            
            if (!sessionData) {
                window.location.href = '../login.html';
                return;
            }

            const user = JSON.parse(sessionData);

            // 1. Update Profile Display
            document.getElementById('displayUserName').innerText = user.fullName;
            document.getElementById('displayUserRole').innerText = user.role;

            // 2. Dynamic Sidebar Logic
            const sidebar = document.getElementById('sidebarMenu');
            const isAdmin = user.role.toLowerCase().includes('admin');

            if (isAdmin) {
                sidebar.innerHTML = `
                    <div class="menu-label">ADMIN PANEL</div>
                    <a href="../admin/admindashboard.html" class="menu-item">Dashboard Summary</a>
                    <a href="welfareregisterpage.html" class="menu-item">Register Welfare</a>
                    <a href="viewapplications.html" class="menu-item active">View Applicants</a>
                    <a href="viewcomplaints.html" class="menu-item">Manage Complaints</a>
                    <a href="../shared/aidtracker.html" class="menu-item">Aid Delivery List</a>

                `;
                document.getElementById('tableTitle').innerText = 'All Village Applications';
            } else {
                sidebar.innerHTML = `
                    <div class="menu-label">USER MENU</div>
                    <a href="../user/userdashboard.html" class="menu-item"><span>My Dashboard</span></a>
                    <a href="welfareregisterpage.html" class="menu-item"><span>Apply Welfare</span></a>
                    <a href="viewapplications.html" class="menu-item active"><span>Check Status</span></a>
                `;
                document.getElementById('tableTitle').innerText = 'My Welfare Status';
            }

            // 3. Initialize and Load Table Data
            loadApplications(isAdmin, user.fullName);
        });

        function loadApplications(isAdmin, currentUserName) {
            if (!localStorage.getItem('welfare_db')) {
                const dummyData = [
                    { id: "APP101", name: currentUserName, type: "Food Basket", date: "2025-12-28", status: "Approved" },
                    { id: "APP102", name: currentUserName, type: "Medical Assistance", date: "2025-12-30", status: "Pending" },
                    { id: "APP103", name: "Siti Aminah", type: "Financial Aid", date: "2025-12-25", status: "Approved" },
                    { id: "APP104", name: "Ramasamy Logan", type: "B40 Support", date: "2025-12-29", status: "Pending" }
                ];
                localStorage.setItem('welfare_db', JSON.stringify(dummyData));
            }

            let apps = JSON.parse(localStorage.getItem('welfare_db'));

            if (!isAdmin) {
                apps = apps.filter(a => a.name === currentUserName);
            }

            const tableBody = document.getElementById('applicationTableBody');
            
            if (apps.length === 0) {
                tableBody.innerHTML = `<div class="table-row"><div class="table-cell" style="width:100%; text-align:center;">No records found.</div></div>`;
                return;
            }

            tableBody.innerHTML = apps.map(app => `
                <div class="table-row">
                    <div class="table-cell" data-label="Name">${app.name}</div>
                    <div class="table-cell" data-label="Type">${app.type}</div>
                    <div class="table-cell" data-label="Date">${app.date}</div>
                    <div class="table-cell" data-label="Status">
                        <span class="status-pill ${app.status === 'Approved' ? 'pill-approved' : 'pill-pending'}">
                            ${app.status}
                        </span>
                    </div>
                    <div class="table-cell" data-label="Action">
                        ${isAdmin ? 
                            `<a href="../admin/reviewapplications.html?id=${app.id}" class="view-btn">View & Reply</a>` : 
                            `<button class="view-btn" onclick="alert('Checking status for: ${app.type}')">Details</button>`
                        }
                    </div>
                </div>
            `).join('');
        }

        function logout() {
            if(confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentUser');
                window.location.href = '../login.html'; 
            }
        }
    </script>
</body>
</html>